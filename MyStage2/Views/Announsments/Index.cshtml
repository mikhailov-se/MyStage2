@model MyStage2.ViewModels.AnnounsmentsVM
@{
    Layout = null;
}
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="widsth=device-widsth, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.15.5/dist/bootstrap-table.min.css">

</head>
<body>

<div class="container container-fluid">


    <table id="table"
           class="table "
           data-toggle="table"
           data-locale="ru-RU"
           data-pagination="true"
           data-show-columns-toggle-all="true"
           data-url="/Announsments/GetAnnounsmentsJson"
           data-checkbox-header="true"
           data-height="500"
           data-virtual-scroll="false"
           data-show-header="true"
           data-click-to-select="true"
    
           >

        <thead style="background-color: #4200be; align-items: center; ">


            <div id="searchDiv">
                <button class="searchControl" style="background: white; width: 130px; border-radius: 50px;">Добавить</button>
                <label>Пользователь</label>
                <select class="searchControl" id="listUsers" asp-items="Model.Users" onchange="filter()" style="border-radius: 5px;">
                    <option>Все</option>
                </select>
                <label>От</label>
                <input class="searchControl" type="date" id="fromDate" onchange="filter()" style="border-radius: 5px;" />
              
                <label>До</label>
                <input class="searchControl" type="date" id="toDate" onchange="filter()"  style="border-radius: 5px;" />

                <input class="searchControl" type="search" id="searchBox" onkeyup="filter()" placeholder="Общий поиск" style="border-radius: 5px;" />
            </div>


        <tr>
            <th data-checkbox="true"></th>
            <th data-sortable="true" data-field="id" data-visible="false">ID</th>
            <th data-sortable="true" data-field="number" data-width="100" data-width-unit="px">Номер</th>
            <th data-sortable="true" data-field="createDate" data-width="15" data-width-unit="%">Создано</th>
            <th data-sortable="true" data-field="textAnnounsment" data-width="40" data-width-unit="%">Объявление</th>
            <th data-sortable="true" data-field="rating" data-width="100">Рейтинг</th>
            <th data-sortable="true" data-field="userName" data-width="200">Пользователь</th>
        </tr>

        </thead>


    </table>

    <div id="setCountOfRowsButtonsDiv" style="color: blueviolet">
        <label>Количество строк на таблице</label>
        <button class="setCountOnPageButton" onclick="setCountRowsOnPage(this,10)">10</button>
        <button class="setCountOnPageButton"  onclick="setCountRowsOnPage(this,50)">50</button>
        <button class="setCountOnPageButton"  onclick="setCountRowsOnPage(this,100)">100</button> 
    </div>

    <div id="removeButtonDiv" >
        <button id="removeButton" class="btn btn-primary d-block ml-auto" onclick="removeAnnounsments()">Удалить</button>
    </div>

</div>

<!-- Modal placeholder -->
<div id="modal-placeholder"></div>



    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/popper.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="~/lib/bootstrap-table.js"></script>
    <script src="~/lib/bootstrap-table-ru-RU.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
    </script>
    

<script>

    $(document).ready(function() {

        setDefaultCountItemsOnPage();

        $("#modal-placeholder").on("hidden.bs.modal",
            function() {
                filter();
            });

        $('.fixed-table-pagination').before($('#removeButtonDiv'));


        $('#table').on("check.bs.table check-all.bs.table ",
            function() {

                document.getElementById("removeButton").style.visibility = 'visible';

            });


        $('#table').on("uncheck.bs.table uncheck-all.bs.table",
            function() {
                document.getElementById("removeButton").style.visibility = 'hidden';
            });

        $('#table').on("dbl-click-row.bs.table",
            function(row, $element) {
                showModalEdit($element.id);
            });
    });


    function showModalEdit(announsmentId) {
        var placeholderElement = $('#modal-placeholder');


        $.ajax('/Announsments/Edit/' + announsmentId).done(function(data) {
            placeholderElement.html(data);
            placeholderElement.find('.modal').modal('show');
        });
    }


    function filter() {
        var searchString = $('#searchBox').val();
        var fromDate = $('#fromDate').val();
        var toDate = $('#toDate').val();
        var selectedUserId = $('#listUsers').val();

        var url = '/Announsments/GetAnnounsmentsJson?searchString=' +
            searchString +
            '&' +
            'fromDate=' +
            fromDate +
            '&' +
            'toDate=' +
            toDate +
            '&' +
            'selectedUserId=' +
            selectedUserId;


        $('#table').bootstrapTable('refresh',
            {
                url: url
            });
    }


    function setCountRowsOnPage(but, count) {

        document.getElementsByClassName("setCountOnPageButton").forEach((item) => {
            item.style.background = 'white';
            item.style.color = '#4200be';


        });;

        but.style.background = '#4200be';
        but.style.color = 'white';


        $('#table').bootstrapTable('refresh',
            {
                pageSize: count
            });
    }


    function removeAnnounsments() {

        var selectedRows = $('#table').bootstrapTable('getSelections');

        var ids = selectedRows.map(function(row) {
            return row.id;
        });

        if (confirm(" Удалить записи  " + ids.length)) {

            $.ajax({
                url: "/Announsments/Delete",
                type: "POST",
                data: { ids: ids },
                success: $('#table').bootstrapTable('remove', { field: 'id', values: ids })
            });
        }
    }

    function setDefaultCountItemsOnPage() {

        var button = document.getElementsByClassName('setCountOnPageButton')[0];
        setCountRowsOnPage(button, 10);

    }

</script>


</body>
</html>


<style>

    .table {

        border-collapse: separate;
        padding: 3px;
        border-spacing: 0 1.3em;
        border: none;
        table-layout: fixed;
        margin-top: -28px;
    }

    .table tbody tr {
        color: #4200be;
        height: 8px;
        overflow: hidden;
    }


    .table thead th {
        border: none;
        color: white;
        font-size: 14px;
        font-weight: 500;
    }

    .fixed-table-body thead { visibility: collapse; }


    .bootstrap-table .fixed-table-pagination::after { display: inline-flex; }

    body {
        color: white;
        font-size: 14px;
        font-weight: 400;
        line-height: 1;
        text-align: center;
    }

    .table td {
        border: 0px #4200be;
        overflow: hidden;
    }

    .table tbody tr {
        border-radius: 50px;
        box-shadow: 0 0 6px gray;
        line-height: 10px;
        overflow: hidden;
    }


    .bootstrap-table .fixed-table-container.fixed-height:not(.has-footer) { border: none; }

    #setCountOfRowsButtonsDiv {
        color: #4200be;
        float: left;
    }

    #setCountOfRowsButtonsDiv button {
        background-color: white;
        border-color: #4200be;
        border-radius: 5px;
        color: #4200be;
        height: 30px;
        margin-left: 10px;
        padding: 2px;
        width: 35px;
    }

    #removeButtonDiv {
        margin-top: 80px;
        visibility: hidden;
    }

    #removeButtonDiv button {

        background-color: #4200be;
        border-radius: 50px;
        height: 35px;
        margin-bottom: 20px;
        margin-right: 50px;
        padding: inherit;
        text-align: center;
        width: 150px;
    }

    .pagination > li > a, .pagination > li > span {
        border: 1px solid #4200be;
        border-radius: 50px;
        color: #4200be;
        margin-right: 10px;
        padding: 6px 13px;
    }

    .page-item.active .page-link {
        background-color: #4200be;
        border-color: #4200be;
        color: white;
        z-index: 1;
    }

    .page-item:first-child .page-link { visibility: hidden; }

    .page-item:last-child .page-link { visibility: hidden; }

    .bootstrap-table .fixed-table-container .table {
        margin-bottom: 0 !important;
        width: 99%;
    }

    .bootstrap-table .fixed-table-container .fixed-table-body {
        overflow-x: auto;
        overflow-y: auto;
    }

    #searchDiv {
        align-items: center;
        background-color: #4200be;
        display: flex;
        height: 70px;
        justify-content: space-evenly;
        margin-left: 3px;
        margin-right: 31px;
        width: auto;
    }

    .searchControl { height: 30px; }

</style>